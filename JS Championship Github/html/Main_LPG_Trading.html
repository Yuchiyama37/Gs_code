<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=Ar5DX7-x0dsBIp7eNcYdVATKsJiBON-wQEf2INNTW2uMnU9Wk4f2UoMQNCMCqkbr' async defer></script>
    <script src="../js/BmapQuery.js"></script>
    <link rel="stylesheet" href="../CSS/reset.css">
    <link rel="stylesheet" href="../CSS/Main.css">
    <link rel="stylesheet" href="../CSS/Main.css" media="screen and (max-width:1200px) and (orientation: portrait)">
    <link rel="stylesheet" href="../CSS/Main.css" media="screen and (max-width:1200px)">
    <link rel="stylesheet" href="../CSS/Main.css" media= "screen and (max-width:700px)">
    <link rel="stylesheet" href="../CSS/Main.css" media= "(max-width:500px) and (orientation: portrait)">
    
    <title>Trading Simulator</title>
</head>

<body>
    <header>
        <p>LPガストレーダーに転生したので、裁定取引で稼いでみた</p>

    </header>
    
    <main>
        <div id="marketInfo">
       
            <div class="Brent"><p>Brent</p></div>
            <div class="MB"><p>MB</p></div>
            <div class="FEI"><p>FEI</p></div>
            <div class="CP"><p>CP</p></div>
            <div Class="Baltic"><p>Baltic(FFA)</p></div>
                <div class="Jan">Jan</div>
                <div class="Feb">Feb</div>
                <div class="Mar">Mar</div>
                <div class="Apr">Apr</div>
                <div class="May">May</div>
                <div class="Jun">Jun</div>
            <div class="JanBrent"></div>
            <div class="FebBrent"></div>
            <div class="MarBrent"></div>
            <div class="AprBrent"></div>
            <div class="MayBrent"></div>
            <div class="JunBrent"></div>
                <div class="JanMB"></div>
                <div class="FebMB"></div>
                <div class="MarMB" id="MarMB"></div>
                <div class="AprMB"></div>
                <div class="MayMB"></div>
                <div class="JunMB"></div>
            <div class="JanFEI"></div>
            <div class="FebFEI"></div>
            <div class="MarFEI"></div>
            <div class="AprFEI"></div>
            <div class="MayFEI"></div>
            <div class="JunFEI"></div>
                <div class="JanCP"></div>
                <div class="FebCP"></div>
                <div class="MarCP"></div>
                <div class="AprCP"></div>
                <div class="MayCP"></div>
                <div class="JunCP"></div>
            <div class="JanBaltic"></div>
            <div class="FebBaltic"></div>
            <div class="MarBaltic"></div>
            <div class="AprBaltic"></div>
            <div class="MayBaltic"></div>
            <div class="JunBaltic"></div>            
        </div>
        
    <!-- CSS Gridで画面分割 -->
    <div class="grid">
        <!-- メニュー画面（サイド） A -->
        <div class="griditemA">    
            <button id="TermContract">Term Contract</button>
            <button id="Window">Window</button>
            <button id="chartering">Chartering</button>
            <button id="hedging">Hedging</button>
            <button id="map">Map</button>
            

            
        </div>

        <!--B ナビゲータ画像 -->
        <div class="griditemB">
            <img id="navigatorImg" src="../Images/Navigator_Normal.png" alt="">
        </div>

        <!-- C メイン画面  -->
        <div class="griditemC" id="MainScreen">
            <!-- マップ表示（初期画面） -->
            <p id="myMap"></p>

            <!-- 用船画面表示 -->
            <div id="CharteringScreen">
            <div id="VesselOptions">
                <div id="AstomosVenus">       
                                      
                    <table class= "VesselDetails">
                        
                        <img src="../Images/Astomos Venus.jpeg" alt="">

                        <tr><td>Name</td><td>Astomos Venus</td></tr>
                        <tr><td>Year Built</td><td>2016</td></tr>
                        <tr><td>Loadable</td><td>46,200MT</td></tr>
                        <tr><td>Laycan</td><td>14-15 Jan, 2023</td></tr>
                        <tr><td>ETA Houston</td><td>13 Jan, 2023</td></tr>
                        <tr><td>Last Disport</td><td>Antwerp</td></tr>
                        <tr><td>Rate Offered</td><td id="VenusRate">$175/MT USGC-FE</td></tr>                        
                    </table>
                </div>         
                <div id="CrystalAsteria">
                    <img src="../Images/Crystal_Asteria.jpeg" alt="">
                    <table class= "VesselDetails">
                        <tr><td>Name</td><td>Crystal Asteria</td></tr>
                        <tr><td>Year Built</td><td>2022</td></tr>
                        <tr><td>Loadable</td><td>46,200MT</td></tr>
                        <tr><td>Laycan</td><td>15-16 Jan, 2023</td></tr>
                        <tr><td>ETA Houston</td><td>16 Jan, 2023</td></tr>
                        <tr><td>Last Disport</td><td>Kawasaki</td></tr>
                        <tr><td>Rate Offered</td><td id="AsteriaRate">$165/MT USGC-FE</td></tr>
                    </table>

                </div>
                <div id="RonaldN">
                    <img src="../Images/Ronald_N.jpeg" alt="">
                    <table class= "VesselDetails">
                        <tr><td>Name</td><td>Ronald N</td></tr>
                        <tr><td>Year Built</td><td>2008</td></tr>
                        <tr><td>Loadable</td><td>42,000MT</td></tr>
                        <tr><td>Laycan</td><td>14-15 Jan, 2023</td></tr>
                        <tr><td>ETA Houston</td><td>13 Jan, 2023</td></tr>
                        <tr><td>Last Disport</td><td>Chiba</td></tr>
                        <tr><td>Rate Offered</td><td id="RonaldNRate">$185/MT USGC-FE</td></tr>
                    </table>
                </div> 
                
            </div> 
            <div id="options">    
                <label>
                    <input type="radio" value="Astomos Venus" name="vessel" id="BookAstomosVenus">
                    Asomos Venus
                </label><br>   
                <label>
                    <input type="radio" value="Crystal Asteria" name="vessel" id="BookCrystalAsteria">
                    Crystal Asteria
                </label><br>   
                <label for="BookRonaldN">
                    <input type="radio" value="Ronald N" name="vessel" id="BookRonaldN">
                    Ronald N
                </label><br>
            </div> 
            <button id="CharterVessel">用船する</button> 
            <!-- END of Chartering -->
                  
            <!-- START of タームFOB条件表示 -->
            </div>
            <div id="TermContractScreen">
                <p>Conditions</p>
                <table>
                    <tr><td>Seller</td><td>: Enterprise</td></tr>
                    <tr><td>Loading Port</td><td>: Houston, U.S.A.</td></tr>
                    <tr><td>Loading Date Range</td><td>: 14th - 15th Jan, 2023</td></tr>
                    <tr><td>Grade & Qtty</td><td>: Propane 46,000 MT +/-5%</td></tr>
                    <tr><td>Price</td><td>: Jan MB + 6.75cpg</td></tr>
                    <tr><td>Deficiency Fee</td><td>: 2.00cpg</td></tr>       

            </table>
            </div>
            <!-- END of タームFOB条件表示 -->

            <!-- START of カーゴ販売画面（window） -->
            <div id="WindowScreen">
                
                <div id="WindowDetails">
                <h1 id="WindowTitle"><p>LPG FAR EAST FORWARD WINDOW</p></h1>
                    <button id="FirstOffer" class="windowitems">Trafigura can Sell C3 46.2KT +/-5% S.O<br>
                       during 2H Feb 2023 bss Chiba<br>
                       at Feb FEI + $15.5 PMT<br>
                       FRT adjustment at $175 PMT bss Hou-Chiba<br>
                    </button>
                    <button id="FirstBid" class="windowitems">Glencore can Buy C3 46.2KT +/-5% S.O<br>
                        during 2H Feb 2023 bss Chiba<br>
                        at Jan FEI - $3.0 PMT<br>
                        FRT adjustment at $175 PMT bss Hou-Chiba<br>
                     </button>
                    <button id="SecondBid" class="windowitems">Glencore can Buy C3 46.2KT +/-5% S.O<br>
                        during 1H Feb 2023 bss Chiba<br>
                        at Feb FEI + $25.5 PMT<br>
                        FRT adjustment at $175 PMT bss Hou-Chiba<br>
                     </button>
                     <button id="ThirdBid" class="windowitems">BP can Buy C3 46.2KT +/-5% S.O<br>
                        during 2H Feb 2023 bss Chiba<br>
                        at Jan FEI + $0.5 PMT<br>
                        FRT adjustment at $100 PMT bss Hou-Chiba<br>
                     </button>
                     <button id="FirstBidRev" class="windowitems">
                        Glencore improved Bid for 2H Feb at Jan FEI Flat<br>
                     </button>
                     <button id="WindowClosed" class="windowitems">
                        Trafigure, Glencore, BP pulled. Nothing done.
                     </button>
                </div>
            </div>
            <!-- END of window画面 -->

            <!-- ヘッジ画面(Hedging) -->
            <div id="HedgingScreen">
                <div id="HedgingDetails">
                    <br>Jan MB/FEI : 
                    <button id="JanMBFEIBid" class="Paperbtn"></button>/<button id="JanMBFEIOffer" class="Paperbtn"></button>
                    <br>Feb MB/FEI : <button id="FebMBFEIBid" class="Paperbtn"></button>/<button id="FebMBFEIOffer" class="Paperbtn"></button>
                    <br>Mar MB/FEI : <button id="MarMBFEIBid" class="Paperbtn"></button>/<button id="MarMBFEIOffer" class="Paperbtn"></button>
                    <br>Jan MB :  <button id="JanMBBid" class="Paperbtn"></button>/<button id="JanMBOffer" class="Paperbtn"></button>
                    <br>Jan CP :  <button id="JanCPBid" class="Paperbtn"></button>/<button id="JanCPOffer" class="Paperbtn"></button>
                    <br>Jun MB/FEI :  <button id="JunMBFEIBid" class="Paperbtn"></button>/<button id="JunMBFEIOffer" class="Paperbtn"></button>
                </div>
            </div>

            

        </div>

        <!-- メッセージ画面 D -->
        <div class="griditemD">
            <div id="messagewindow"></div>
            <p id="line0">
                おめでとうございます、今日からあなたは当社のTrading Managerです!<br>
                あなたの最初のミッションはLPG部門のヘッドとして、米国タームFOB購入契約を適切にマネージして利益を最大化することです!!<br>
                <br>まずは、Term Contractをクリックして現在保有している契約を確認してみてはどうでしょうか？
            </p>

        </div>
        <!-- ポジション表示 E -->
        <div class="griditemE">
            <h1>ポジション(KT)</h1>
            <h2>＜Pysical(現物)＞</h2>
            <table id="PhysicalPosition">
            <tr>
                <td class="FPTitle">購入数量</td>
                <td  class="positionNum">
                    <input type="number" id="PhysicalQttyB" readonly>
                </td>
            
            </tr>
            <tr>
                <td class="FPTitle">販売数量</td>
                <td class="positionNum">
                    <input type="number" id="PhysicalQttyS" readonly>
                </td>
            </tr>
            <tr>
                <td class="FPTitle">船腹</td>
                <td><input type="number" id="FRTQtty" readonly></td>
            </tr>
            <tr><td></td><td></td></tr>
            <tr><td></td><td></td></tr>
            </table>
            
            <br><h2>＜Financial＞</h2>
            <table id="FinancialPosition">
            <tr>
                <td id="JanMBCount" class="FPTitle"></td>
                <td class="positionNum">
                    <input type="number" id="FinancialJanMB" readonly>
                </td>
            </tr>
            <tr>
                <td id="JanMBCountP" class="FPTitle"></td>
                <td class="positionNum">
                    <input type="number" id="FinancialJanMBP" readonly>
                </td>
            </tr>
            <tr class="countTotal">
                <td id="JanMBTotal" class="FPTitle"></td>
                <td class="positionNum">
                    <input type="number" id="JanMBCountTotal" readonly>
                </td>
            </tr>
            <tr>
                <td id="JanFEICount" class="FPTitle"></td>
                <td  class="positionNum">
                    <input type="number" id="FinancialJanFEI" readonly>
                </td>
            </tr>
            <tr>
                <td id="JanFEICountP" class="FPTitle"></td>
                <td  class="positionNum">
                    <input type="number" id="FinancialJanFEIP" readonly>
                </td>
            </tr>
            <tr class="countTotal">
                <td id="JanFEITotal" class="FPTitle"></td >
                <td  class="positionNum">
                    <input type="number" id=JanFEICountTotal readonly>
                </td>
            </tr>
            </table>
            <h2>＜現在の損益($)＞</h2>
            <input type="number" id="TotalPLAmount" readonly>
            <table id="PLSummary">
                <tr><td class="PLTitle">購入金額(千$)</td></tr>
                <tr>
                    <td class="FPTitle">カーゴ</td>
                    <td class="PLNum">
                        <input type="number" id="FOBDollarAmount" readonly>
                    </td>
                </tr>
                <tr>
                    <td class="FPTitle">Paper</td>
                    <td><input type="number" id="PaperDollarAmountB" readonly></td>
                </tr>
                <tr>
                    <td class="FPTitle">船腹</td>
                    <td><input type="number" id="FRTDollarAmount" readonly></td>
                </tr>
                <tr><td class="PLTitle">販売金額(千$)</td></tr>
                <tr>
                    <td class="FPTitle">カーゴ</td>
                    <td><input type="number" id="CFRDollarAmount" readonly></td></tr>
                <tr>
                    <td class="FPTitle">Paper</td>
                    <td><input type="number" readonly></td>
                </tr>
                <tr>
                    <td class="FPTitle">船腹</td>
                    <td><input type="number" readonly=""></td>
                </tr>
            </table>

           
            <button class="modal-open" id="finish">Finish!!!</button>
        </div>
        <!-- モーダルWindow -->
     <div class="overlay" id="js-overlay"></div> 
     <div class="modal" id="jsmodal">
        <div class="modal-close_wrap" >
            <button class="modal-close" id="js-close">
                <span></span>
                <span></span>
            </button>
        </div>
        <p id="end">取引完了！！</p>
        <p id="Result">稼ぎました！！</p>
        <p id="note">☆☆☆現実はこんなにチョロくないですよ☆☆☆</p>
     </div>
     
    </div>
    </main>

    <footer>

    </footer>

    <!-- START of BAMPQUERY -->
<script>
    //****************************************************************************************
      // BingMaps&BmapQuery
      //****************************************************************************************
      //Init
    
      // 変数mapを定義
      let map; // グローバル関数にする。下の処理の結果が変数mapに代入される。
      function GetMap(){
          //------------------------------------------------------------------------
          //1. Instance
          //------------------------------------------------------------------------
          map = new Bmap("#myMap");
            // myMapというdivにマップを表示する指示
            
      
          //------------------------------------------------------------------------
          //2. Display Map
          //------------------------------------------------------------------------
          map.startMap(35, 145, "load", 3); //The place is Bellevue.
              // マップの開始位置を指定
    
          //----------------------------------------------------
          //3. Add Pushpin
          // map.pin( lat, lon, "color", [drag:true|false], [click:true|false], [hover:true|false], [visible:true|false] );
          //----------------------------------------------------
          // let pin = map.pin(47.6149, -122.1941, "#ff0000");
          // let pin2 = map.pin(47.9, -122.1941, "#ff0000");
          // map.infobox(47.6149, -122.1941, "title", "description");
      
      }
    </script>

<!-- FIREBASE - Auth, FireSore, RTDB-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } 
    from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-auth.js"
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved }
    from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-database.js"
    import { getFirestore, collection, doc, addDoc, getDoc, setDoc, Timestamp, updateDoc, arrayUnion, arrayRemove, increment, deleteDoc, deleteField,  }
    from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-firestore.js"

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "",
      authDomain: "js-championship-f6b37.firebaseapp.com",
      databaseURL: "https://js-championship-f6b37-default-rtdb.firebaseio.com",
      projectId: "js-championship-f6b37",
      storageBucket: "js-championship-f6b37.appspot.com",
      messagingSenderId: "1063801575454",
      appId: "1:1063801575454:web:cf60eda4c252f8a7ceb60f"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Initialize Firebase Authentication and get a reference to the service
    const auth = getAuth(app);
    //データベース(realtime database)に接続
    const rtdb = getDatabase(app); 
            const dbRef = ref(rtdb, "userAccount");
        //Realtime DB内のuserAccountを使う
    const fsdb = getFirestore(app);

    // 日付設定
    let currentYear = 2023;
    let previousYear = currentYear - 1;
    let Month = ["Dec"+previousYear, "Jan"+currentYear, "Feb"+currentYear, "Mar"+currentYear, "Apr"+currentYear, "May"+currentYear, "Jun"+currentYear]
    let thisMonth = 0;
    $("#now").append(Month[thisMonth]);       
 
//START of MarketInfo 
    // マーケット情報設定
        // brentからLPGのカーブを作成する
        // FEI/CPはBalticから算出？
    let brent = 0;
    let brent2 = brent;
    // 開始時ブレントを設定
    const r1 = Math.ceil(Math.random()*5);
        if(r1 == 1){
            brent = 79.42;
            $(".JanBrent").append(brent);
        }if(r1 == 2){
            brent = 79.56;
            $(".JanBrent").append(brent);
        }if(r1 == 3){
            brent = 79.75
            $(".JanBrent").append(brent);
        }if(r1 == 4){
            brent = 79.95
            $(".JanBrent").append(brent);
        }if(r1 == 5){
            brent = 80.05
            $(".JanBrent").append(brent);
        }
    $(".FebBrent").append(Math.round((brent-0.2)*100)/100);
    $(".MarBrent").append(Math.round((brent-0.4)*100)/100);
    $(".AprBrent").append(Math.round((brent-0.6)*100)/100);
    $(".MayBrent").append(Math.round((brent-0.7)*100)/100);
    $(".JunBrent").append(Math.round((brent-0.8)*100)/100);

// MBカーブ設定
    let MBBrent = 1;
    let MB = brent 
    //MBのブレント比バリューを85%, 87.5%, 90%のいずれかに設定
    const r2 = Math.ceil(Math.random()*3);
        if(r2 == 1){
            MBBrent = 1.18;
        }if(r2 == 2){
            MBBrent = 1.2;
        }if(r2 == 3){
            MBBrent = 1.23;
        }
    let JanMB = Math.round(MB * MBBrent*100)/100
    $(".JanMB").append(JanMB);
    $(".FebMB").append(Math.round((JanMB-2)*100)/100);
    $(".MarMB").append(Math.round((JanMB-6.5)*100)/100);
    $(".AprMB").append(Math.round((JanMB-11.5)*100)/100);
    $(".MayMB").append(Math.round((JanMB-13.25)*100)/100);
    $(".JunMB").append(Math.round((JanMB-13.75)*100)/100);
    
//CPカーブ設定
    let CPBrent = 1;
    let CP = brent * 8.2;
    //Jan CPのBrent比バリューを102%, 105%, 108%のいずれかに設定
    const r3 = Math.ceil(Math.random()*3);
        if(r3 == 1){
            CPBrent = 1.00;
        }if(r3 == 2){
            CPBrent = 1.06;
        }if(r3 == 3){
            CPBrent = 1.08;
        }
    let JanCP = Math.round(CP * CPBrent);
    //CP TimeSpreadをランダムに設定
    let CPJanFeb = 1;
    let CPFebMar = 1;
    let CPMarApr = 1;
    let CPAprMay = 1;
    let CPMayJun = 1;
     const CPTS = Math.ceil(Math.random()*3);
        if(CPTS == 1){
            CPJanFeb = 5; 
            CPFebMar = 15;
            CPMarApr = 35;
            CPAprMay = 50;
            CPMayJun = 58
        }if(CPTS == 2){
            CPJanFeb = 10; 
            CPFebMar = 28;
            CPMarApr = 60;
            CPAprMay = 82;
            CPMayJun = 94
        }if(CPTS == 3){
            CPJanFeb = 3; 
            CPFebMar = 15;
            CPMarApr = 33;
            CPAprMay = 42;
            CPMayJun = 42
        }
    $(".JanCP").append(JanCP);
    $(".FebCP").append(Math.round(JanCP-CPJanFeb));
    $(".MarCP").append(Math.round(JanCP-CPFebMar));
    $(".AprCP").append(Math.round(JanCP-CPMarApr));
    $(".MayCP").append(Math.round(JanCP-CPAprMay));
    $(".JunCP").append(Math.round(JanCP-CPMayJun));

    // Balticのカーブ設定
    let JanBaltic = 75.5;
    const r4 =  Math.ceil(Math.random()*2);
    let BalticJanFeb = 0;
    let BalticFebMar = 0;
    let BalticMarApr = 0;
    let BalticAprMay = 0;
    let BalticMayJun = 0;
        if(r4 == 1){
            BalticJanFeb = 1.25
            BalticFebMar = 0.75
            BalticMarApr = 0.75
            BalticAprMay = 0.75
            BalticMayJun = 0.75
        }if(r4 == 2){
            BalticJanFeb = -1.25
            BalticFebMar = -0.75
            BalticMarApr = -0.75
            BalticAprMay = -0.75
            BalticMayJun = -0.75
        }
    $(".JanBaltic").append(JanBaltic);
    $(".FebBaltic").append(JanBaltic + BalticJanFeb);
    $(".MarBaltic").append(JanBaltic + BalticFebMar);
    $(".AprBaltic").append(JanBaltic + BalticMarApr);
    $(".MayBaltic").append(JanBaltic + BalticAprMay);
    $(".JunBaltic").append(JanBaltic + BalticMayJun); 
    
    //FEIカーブ設定
    // Jan baltic - $30 + Jan CP = Feb FEIと設定
        let FebFEI = JanCP + JanBaltic - 45;
         $(".FebFEI").append(FebFEI);
    // CPTSからFEIカーブを算出
    let FEIJanFeb = CPJanFeb ;
    let FEIFebMar = CPMarApr ;
    let FEIMarApr = CPAprMay ;
    let FEIAprMay = CPMayJun ;
    let FEIMayJun = CPMayJun ;
    $(".JanFEI").append(FebFEI + FEIJanFeb);
    $(".MarFEI").append(FebFEI - FEIFebMar);
    $(".AprFEI").append(FebFEI - FEIMarApr);
    $(".MayFEI").append(FebFEI - FEIAprMay);
    $(".JunFEI").append(FebFEI - FEIMayJun);
// END of MarketInfo //

//ナビゲーターの表情バリエーション設定
const Normal = "../Images/Navigator_Normal.png";
const Smile = "../Images/Navigator_Smile.png";
const Angry = "../Images/Navigator_Angry.png";
const Surprised = "../Images/Navigator_Surprised.png";
const Sad = "../Images/Navigator_Sad.png";
const Cool = "../Images/Navigator_Cool.png";

// START of Main Menu画面遷移 //
//画面非表示設定
$("#TermContractScreen").toggle(false);
$("#CharteringScreen").toggle(false);
$("#WindowScreen").toggle(false);
$("#HedgingScreen").toggle(false);
$("#js-modal").toggle(false);

//各アクティビティの完了・未完了のフラグ
let FOBDecision = "yet";
let Chartering = "yet";
let WindowSales = "yet"
let Hedging = "yet"
let VesselName ="";

//ポジション表に表示する数値の設定
//Physical
let PhysicalQttyB = 0;
let PhysicalQttyS =0;
let FRTQtty = 0;

//Financial
let JanMBPosition = 0;
let JanMBPositionP = 0;
let JanFEIPosition =0;
let JanFEIPositionP =0;

//損益計算に使う変数
// FOB購入金額
let FOBPrice = Math.round((document.querySelector(".JanMB").innerHTML * 5.21)*10)/10;
let FOBPrem = 6.75 * 5.21
let TotalFOBPrice = Math.round((FOBPrice + FOBPrem)*10)/10


// 船購入金額
let FRTRate = 0;


//CFR販売金額
let CFRPrice = Math.round((document.querySelector(".JanFEI").innerHTML)*10)/10;
let CFRPrem  = 0;
let TotalCFRPrice = CFRPrice + CFRPrem;

let PurchasedAmount = Math.trunc(Number(document.querySelector("#FOBDollarAmount").value));
let SalesAmount = Math.trunc(Number(document.querySelector("#CFRDollarAmount").value));
let FRTDollarAmount = Math.trunc(Number(document.querySelector("#FRTDollarAmount").value));
let TotalPL = 0;

$("#TotalPLAmount").val(TotalPL)
console.log(PurchasedAmount);



//ポジション・PL計算
$("#FinancialJanMB").change(function(){
    MBPhysical = document.querySelector("#FinancialJanMB").val;
    MBPapaer = document.querySelector("#FinancialJanMBP").val;
    $("#JanMBCountTotal").val(MBPhysical + MBPapaer);
})

//PL計算




// タームFOBのキャンセル判断
    $("#TermContract").on("click", function(){
    document.querySelector("#navigatorImg").src = Normal;
    //他のメニュー画面消す
    $("#myMap").toggle(false);
    $("#CharteringScreen").toggle(false);
    $("#WindowScreen").toggle(false);
    $("#HedgingScreen").toggle(false);
    //トレーディング画面出す
    $("#TermContractScreen").toggle(true);
    if(FOBDecision == "yet"){
        // 初めてクリックした場合
    $("#TermContractScreen").toggle(true);
    $("#line0").html("当社が保有している1月の米国FOBのキャンセル期限が迫っています!!<br>どうしますか？契約条件と市況を市況を確認して、引き取るのかキャンセルするのか判断しましょう！")
    $("#line0").append(`<br><button id="purchased">このまま引き取る</button>`)
    $("#line0").append(`<br><button id="cancelled">キャンセルする</button>`)
    }if(FOBDecision == "completed"){
        // ２回目以降にクリックした場合
        if(Chartering == "yet"){
            // 船の手配がまだの場合
        $("#line0").html("次は船を手配してはどうでしょうか？")
    }
        if(Chartering == "completed"){
            // 先に船を手配していた場合
        $("#line0").html("FOBと船の準備が整いましたね!<br>次はカーゴの販売とヘッジに挑戦しましょう！")
    }}
    });
    // キャンセル経済性の計算：これを元にボタンクリック後の挙動が分岐
    let JanFOB = document.querySelector(".JanMB").innerHTML;
    let FRTCost = document.querySelector(".JanBaltic").innerHTML;
    let FRTCostAdjusted = 175;
    let FOBValue = JanFOB*5.21;
    let TF = 4.75 * 5.21;
    let TotalCost = FOBValue + TF + FRTCostAdjusted;
    let ArrivalValue = document.querySelector(".JanFEI").innerHTML;
    
    //実行ボタンクリック
    $(document).on("click", "#purchased", function(){
        $("#line0").html("");
        console.log(ArrivalValue);
        console.log(TotalCost);
        if(TotalCost > ArrivalValue){
            $("#line0").html("今のマーケットで引き取るのはよろしくないかと...<br>もう一度考え直してみましょう！");
        document.querySelector("#navigatorImg").src = Sad;
        }else{
            $("#line0").html("この状況であれば引き取った方が良さそうですね。");
            if(Chartering == "yet"){
                $("#line0").append("<br>次は船を手配してはどうでしょうか？")
            }if(Chartering == "completed"){
                $("#line0").append("<br>次はカーゴの販売とヘッジに挑戦しましょう！")
            };  
            document.querySelector("#navigatorImg").src = Smile
            //Ronald Nの場合
            if(VesselName == "Ronald N"){
                PhysicalQttyB = PhysicalQttyB +42;
                //ポジション表に数字を表示
                $("#PhysicalQttyB").val(PhysicalQttyB);
                $("#JanMBCount").html("Jan MB(現物)");
                $("#JanMBTotal").html("Jan MB計");
                JanMBPosition = JanMBPosition + 42
                $("#FinancialJanMB").val(JanMBPosition);
                PurchasedAmount = Math.round((TotalFOBPrice * PhysicalQttyB *-1)*10)/10;
                //損益に数字を表示
                $("#FOBDollarAmount").val(PurchasedAmount);//テキストボックスの場合はval
                TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
                 $("#TotalPLAmount").val(TotalPL)
                
            }
            // 他の船の場合
            else{
                PhysicalQttyB = PhysicalQttyB +46.2;
                //ポジション表に数字を表示
                $("#PhysicalQttyB").val(PhysicalQttyB);
                $("#JanMBCount").html("Jan MB(現物)");
                $("#JanMBTotal").html("Jan MB計");
                JanMBPosition = JanMBPosition + 46.2
                $("#FinancialJanMB").val(JanMBPosition);
                PurchasedAmount = Math.round((TotalFOBPrice * PhysicalQttyB *-1)*10)/10;
                //損益に数字を表示
                $("#FOBDollarAmount").val(PurchasedAmount);//テキストボックスの場合はval
                TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
                $("#TotalPLAmount").val(TotalPL)
            //地味にカンマ区切りを入れるのが難易度高い
                // let PLnum = Math.trunc(Number(document.querySelector("#TotalPLAmount").value));
                //  let PLnum2 = PLnum.toLocaleString();
                //  $("#TotalPLAmount").val(PLnum2)

            }
            FOBDecision = "completed"
        }
    })
    //キャンセルボタンクリック
    $(document).on("click", "#cancelled", function(){
        if(TotalCost > ArrivalValue){
            console.log(ArrivalValue);
        console.log(TotalCost);
        $("#line0").html("マーケットの状況から的確な判断ができましたね！<br>異なるマーケット下でも正しい判断ができるか、試してみましょう！");
        document.querySelector("#navigatorImg").src = Smile;
        window.setTimeout(function(){
            location.reload();},1500);//1.5秒後にリロード
        }else{
            $("#line0").html("本当にキャンセルが正しい判断でしょうか..?<br>もう一度考えてみましょう。");
        document.querySelector("#navigatorImg").src = Cool;  
        }
    })

//用船の判断
    $("#chartering").on("click", function(){
        $("#myMap").toggle(false);
        $("#TermContractScreen").toggle(false);
        $("#WindowScreen").toggle(false);
         $("#HedgingScreen").toggle(false);
        //用船画面出す
        $("#CharteringScreen").toggle(true);
        if(Chartering == "yet"){
        document.querySelector("#navigatorImg").src = Normal;
        $("#line0").html("アストモスエネルギーから３隻のオファーを受領しましたよ！<br>どの船に1月のFOBを積んでもらいましょうか？")
        }else{
        $("#line0").html("うまく用船できました！<br>次はカーゴの販売とヘッジに挑戦しましょう！")
        }
    });

    //船を決定
    $("#CharterVessel").on("click", function(){
        VesselName = $('input[name="vessel"]:checked').val();
        console.log(VesselName);
        $("#CharterVessel").prop("disabled", true);
        $('input[name="vessel"]').prop("disabled", true)
        //Astomos Venusを選択した場合
        if(VesselName == "Astomos Venus"){
        $("#line0").html(`${VesselName}!<br>三菱重工長崎生まれで、しっかりしたいいコですよ！<br>欧州揚げ切りで動静も問題なさそうです。`)
        document.querySelector("#navigatorImg").src = Smile;
        FRTRate = 175;
        FRTQtty = 46.2;
        $("#FRTQtty").val(FRTQtty);
        FRTDollarAmount = Math.round((FRTRate * FRTQtty *-1)*10)/10;
        $("#FRTDollarAmount").val(FRTDollarAmount);
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
        $("#TotalPLAmount").val(TotalPL)
        Chartering = "completed"
        }
        //Crystal Asteriaを選択した場合
        if(VesselName == "Crystal Asteria"){
        $("#line0").html(`${VesselName}!<br>最新鋭で頼りになるコですが...<br>今回のお仕事に間に合うでしょうか...?<br>もう一度考え直してみてくださいね。`)
        document.querySelector("#navigatorImg").src = Sad;
        $("#CharterVessel").prop("disabled", false);
        $('input[name="vessel"]').prop("disabled", false)
        }
        //Ronald Nを選択した場合
        if(VesselName == "Ronald N"){
        $("#line0").html(`${VesselName}ですか!!!<br>積載数量は減ってしまいますが、手堅い選択です。<br>Old-Panamaxなので極東揚げ切りでも動静に不安はありません。<br>Houstonで積んだ後のパナマ通峡もバッチリですね!!`)
        document.querySelector("#navigatorImg").src = Surprised;
        //ポジション表・損益に数字を表示
        FRTRate = 195;
        FRTQtty = 42;
        $("#FRTQtty").val(FRTQtty);
        FRTDollarAmount = Math.round((FRTRate * FRTQtty *-1)*10)/10;
        $("#FRTDollarAmount").val(FRTDollarAmount);
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
        $("#TotalPLAmount").val(TotalPL)
        console.log(TotalPL);

        Chartering = "completed"
        //ポジション表に船のサイズ差を反映
        if(FOBDecision == "completed"){
            PhysicalQttyB = PhysicalQttyB -4.2;
            JanMBPosition = JanMBPosition - 4.2;
            $("#FinancialJanMB").val(JanMBPosition);
            $("#PhysicalQttyB").val(PhysicalQttyB);
            //PL再計算
            $("#FOBDollarAmount").val(TotalFOBPrice * FRTQtty *-1);
            
        }if(WindowSales == "completed"){
            PhysicalQttyB = PhysicalQttyB -4.2;
            JanMBPosition = JanMBPosition - 4.2;
            PhysicalQttyS = PhysicalQttyS +4.2;
            JanFEIPosition = JanFEIPosition + 4.2;
            JanFEIPositionP = JanFEIPositionP - 4.2;
            JanMBPositionP = JanMBPositionP + 4.2;
            $("#FinancialJanFEI").val(JanFEIPosition);
            $("#PhysicalQttyS").val(PhysicalQttyS);
            $("#JanMBCountTotal").val(JanMBPosition + JanMBPositionP);
            $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);  
            // PL再計算
            $("#CFRDollarAmount").val(TotalCFRPrice * FRTQtty);
        }if(Hedging == "completed"){
            PhysicalQttyB = PhysicalQttyB -4.2;
            JanMBPosition = JanMBPosition - 4.2;
            PhysicalQttyS = PhysicalQttyS +4.2;
            JanFEIPosition = JanFEIPosition + 4.2;
            JanFEIPositionP = JanFEIPositionP - 4.2;
            JanMBPositionP = JanMBPositionP + 4.2;
            $("#FinancialJanMBP").val(JanMBPositionP);
            $("#FinancialJanFEIP").val(JanFEIPositionP);
            // $("#JanMBCountTotal").val(JanMBPosition + JanMBPositionP);
            // $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);  
        }
        }
    })
// カーゴ販売の判断
$("#Window").on("click", function(){
    $("#myMap").toggle(false);
    $("#TermContractScreen").toggle(false);
    $("#CharteringScreen").toggle(false);
    $("#HedgingScreen").toggle(false);
    $("#WindowScreen").toggle(false);
    $("#WindowScreen").toggle(true);
    $("#WindowTitle").toggle(true);
    $(".windowitems").toggle(false);
    if(FOBDecision == "yet"){
        $("#line0").html("まずはターム契約をどうするのか考えた方がいいと思いますよ！")
    }else if(FOBDecision == "completed"){document.querySelector("#navigatorImg").src = Cool;
    $("#line0").html("Windowでは、上記画面を通じてマーケット参加者が提示する買い唱え(Bid)や売り唱え(Offer)に応じる(Hit,Book)ことでカーゴの売買を成約できます。<br>"
    +"自分からBid/Offerを提示することもできますが、今回は出てきたBidをHitしてみましょう!<br>"
    +"よい条件のBid/Offerは他の参加者に先を越されてしまう可能性もありますが、一度Hitして成約したものはキャンセルできませんから、慎重にお願いしますね。")
    $("#line0").append(`<button id="WindowStart">Windowに参加する</button>`);}
    if(WindowSales == "completed"){
        $("#line0").html("現物のポジションはバランスしましたね。")
    document.querySelector("#navigatorImg").src = Normal;
    $(".windowitems").toggle(false);
    }
    });  
    
    $(document).on("click", "#WindowStart", function(){
        $(".windowitems").prop("disabled", false)
        window.setTimeout(function(){
        $("#FirstOffer").toggle(true)}, 1000)
        window.setTimeout(function(){
        $("#FirstBid").toggle(true)}, 2500)
        window.setTimeout(function(){
        $("#SecondBid").toggle(true)}, 4500)
        window.setTimeout(function(){
        $("#ThirdBid").toggle(true)}, 6500)
        window.setTimeout(function(){
        $("#FirstBidRev").toggle(true)}, 9000)
        window.setTimeout(function(){
        $("#WindowClosed").toggle(true)}, 10500)
        window.setTimeout(function(){
        $(".windowitems").prop("disabled", true)}, 11000)
        window.setTimeout(function(){
        if(WindowSales == "yet"){
        $("#line0").html("window時間終了です。実際のWindowも17時丁度で終了して、全てのBid/Offerは引けてしまいます。"
        +"<br>終了時間ギリギリに条件を改善してくるプレイヤーも実際に多くいます。"
        +"<br>今ので要領はわかったのではないでしょうか?"
        +"<br>もう一度挑戦してみましょう！！")}
        }, 11000)
    })

$("#FirstOffer").on("click", function(){
    $("#line0").html("それは売り唱え(Offer)です！<br>慎重に、って言ったじゃないですかー！")
    document.querySelector("#navigatorImg").src = Angry;
});
//正解の選択肢1
$("#FirstBid").on("click", function(){
    $(".windowitems").prop("disabled", true);
    $("#line0").html("成約しましたよ！")
    document.querySelector("#navigatorImg").src = Smile;
    if(VesselName == "Ronald N"){
        PhysicalQttyS = PhysicalQttyS - 42;
        $("#PhysicalQttyS").val(PhysicalQttyS);
        $("#JanFEICount").html("Jan FEI(現物)");
        JanFEIPosition = JanFEIPosition - 42;
        console.log(JanFEIPosition);
        $("#FinancialJanFEI").val(JanFEIPosition);
        $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);
        $("#JanFEITotal").html("Jan FEI計");
         // PL計算
         $("#CFRDollarAmount").val(TotalCFRPrice * JanFEIPosition *-1)
        console.log(TotalCFRPrice);
        SalesAmount = Math.trunc(Number(document.querySelector("#CFRDollarAmount").value));
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
        $("#TotalPLAmount").val(TotalPL)
        console.log(PurchasedAmount+SalesAmount);
        console.log(SalesAmount);
    }else{
        PhysicalQttyS = PhysicalQttyS - 46.2
        $("#PhysicalQttyS").val(PhysicalQttyS);
        $("#JanFEICount").html("Jan FEI(現物)");
        $("#JanFEITotal").html("Jan FEI計");
        JanFEIPosition = JanFEIPosition - 46.2
        console.log(JanFEIPosition);
        $("#FinancialJanFEI").val(JanFEIPosition);
        $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP); 
        // PL計算
        $("#CFRDollarAmount").val(TotalCFRPrice * JanFEIPosition *-1)
        SalesAmount = Math.trunc(Number(document.querySelector("#CFRDollarAmount").value));
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
        $("#TotalPLAmount").val(TotalPL)
    }
    WindowSales = "completed"

});
$("#FirstBid").on("click", function(){
    $(".windowitems").prop("disabled", true);
    $("#FirstBidRev").html("Glencore pulled bid for 2H Feb")
    $("#line0").html("成約しましたよ！")
    document.querySelector("#navigatorImg").src = Smile;

});
$("#SecondBid").on("click", function(){
    $(".windowitems").prop("disabled", true);
    $("#line0").html("その買い唱えは2月前半着が前半着が条件ですが、1月14-15日積みのHouston積みFOBカーゴでデリバリーできるでしょうか..?")
    document.querySelector("#navigatorImg").src = Sad;

});

$("#ThirdBid").on("click", function(){
    $(".windowitems").prop("disabled", true);
    $("#line0").html("これは..!<br>Nice Deal!と、言いたいところですが、最後の行の条件をよ〜く読んでみてください。")
    document.querySelector("#navigatorImg").src = Surprised;

});
//正解の選択肢2
$("#FirstBidRev").on("click", function(){
    $(".windowitems").prop("disabled", true);
    $("#line0").html("成約しましたよ！")
    document.querySelector("#navigatorImg").src = Smile;
    if(VesselName == "Ronald N"){
        PhysicalQttyS = PhysicalQttyS - 42;
        $("#PhysicalQttyS").val(PhysicalQttyS);
        $("#JanFEICount").html("Jan FEI(現物)");
        JanFEIPosition = JanFEIPosition - 42;
        console.log(JanFEIPosition);
        $("#FinancialJanFEI").val(JanFEIPosition);
        $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);
        $("#JanFEITotal").html("Jan FEI計");
        console.log("aaa");
        // PL計算
        $("#CFRDollarAmount").val(TotalCFRPrice * JanFEIPosition *-1)
        SalesAmount = Math.trunc(Number(document.querySelector("#CFRDollarAmount").value));
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10;
        console.log(SalesAmount);
        $("#TotalPLAmount").val(TotalPL)
    }else{
        PhysicalQttyS = PhysicalQttyS - 46.2
        $("#PhysicalQttyS").val(PhysicalQttyS);
        $("#JanFEICount").html("Jan FEI(現物)");
        $("#JanFEITotal").html("Jan FEI計");
        JanFEIPosition = JanFEIPosition - 46.2
        $("#FinancialJanFEI").val(JanFEIPosition);
        $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP); 
        // PL計算
        $("#CFRDollarAmount").val(TotalCFRPrice * JanFEIPosition *-1)
        SalesAmount = Math.trunc(Number(document.querySelector("#CFRDollarAmount").value));
        TotalPL = Math.round((PurchasedAmount + SalesAmount + FRTDollarAmount)*1000*10)/10
        $("#TotalPLAmount").val(TotalPL)
    }
    WindowSales = "completed"

});
    
// ヘッジの判断
$("#hedging").on("click", function(){
    $("#TermContractScreen").toggle(false);
    $("#CharteringScreen").toggle(false);
    $("#WindowScreen").toggle(false);
    $("#myMap").toggle(false);
    $("#HedgingScreen").toggle(true);
    if(FOBDecision == "yet"){
        $(".Paperbtn").prop("disabled", true)
        $("#line0").html("まずはターム契約をどうするのか考えた方がいいと思いますよ！")
    }else if(Chartering == "yet"){
        $(".Paperbtn").prop("disabled", true)
        $("#line0").html("まずは船を手配した方がいいと思いますよ！")
    }
    // else if(WindowSales == "yet"){
    //     $("#line0").html("先に現物の販売を決めてしまいましょう！")
    // }
    else if(Hedging == "yet"){
    $(".Paperbtn").prop("disabled", false)
    $("#line0").html("購入しているHouston積みFOBはMB価格で、販売条件はFEI価格です。"
    +"<br>二つの価格指標はそれぞれ別の値動きをする可能性があるので、このままにしておくことにはリスクがあります。"
    +"<br><br>そこで先物を活用して二つの価格指標の値差を固定して、利幅を確定させましょう。"
    +"<br>あと一息です！頑張りましょう！")
    document.querySelector("#navigatorImg").src = Normal;
    }
    if(Hedging == "completed"){
        $(".Paperbtn").prop("disabled", true)
        $("#line0").html("ヘッジも完了しましたね！！")
        document.querySelector("#navigatorImg").src = Smile;
        $("#line0").html("ヘッジは完了しましたね！！")
    if(Chartering == "yet"){   
        $("#line0").append("<br>船の手配もしてしまいましょう！")
    }
    }
})

//各種Bid/Offer設定
const JanMBPaper = Math.round(document.querySelector(".JanMB").innerHTML * 5.21*10)/10;
const JanFEIPaper = document.querySelector(".JanFEI").innerHTML;
let JanMBFEIBid = Math.round((JanMBPaper - JanFEIPaper - 2)*10)/10;
$("#JanMBFEIBid").append(JanMBFEIBid);
let JanMBFEIOffer = Math.round((JanMBPaper - JanFEIPaper)*10)/10;
$("#JanMBFEIOffer").append(JanMBFEIOffer);

const FebMBPaper = Math.round(document.querySelector(".FebMB").innerHTML * 5.21*10)/10;
const FebFEIPaper = document.querySelector(".FebFEI").innerHTML;
let FebMBFEIBid = Math.round((FebMBPaper - FebFEIPaper - 1)*10)/10;
$("#FebMBFEIBid").append(FebMBFEIBid);
let FebMBFEIOffer = Math.round((FebMBPaper - FebFEIPaper + 3)*10)/10;
$("#FebMBFEIOffer").append(FebMBFEIOffer);

const MarMBPaper = Math.round(document.querySelector(".MarMB").innerHTML * 5.21*10)/10;
const MarFEIPaper = document.querySelector(".MarFEI").innerHTML;
let MarMBFEIBid = Math.round((FebMBPaper - FebFEIPaper - 2)*10)/10;
$("#MarMBFEIBid").append(MarMBFEIBid);
let MarMBFEIOffer = Math.round((FebMBPaper - FebFEIPaper + 4)*10)/10;
$("#MarMBFEIOffer").append(MarMBFEIOffer);

let JanMBSwapBid = JanMBPaper - 3;
$("#JanMBBid").append(JanMBSwapBid);
let JanMBSwapOffer = JanMBPaper + 2;
$("#JanMBOffer").append(JanMBSwapOffer);


let JanCPBid = document.querySelector(".JanCP").innerHTML - 1;
$("#JanCPBid").append(JanCPBid);
let JanCPOffer = document.querySelector(".JanCP").innerHTML ;
$("#JanCPOffer").append(JanCPOffer);

const JunMBPaper = Math.round(document.querySelector(".JunMB").innerHTML * 5.21*10)/10;
const JunFEIPaper = document.querySelector(".JunFEI").innerHTML;
let JunMBFEIBid = Math.round((JanMBPaper - JanFEIPaper - 2)*10)/10;
$("#JunMBFEIBid").append(JunMBFEIBid);
let JunMBFEIOffer = Math.round((JanMBPaper - JanFEIPaper +1)*10)/10;
$("#JunMBFEIOffer").append(JunMBFEIOffer);

//ヘッジのボタンアクション
//正解の選択肢
$("#JanMBFEIOffer").on("click", function(){
    $("#line0").html("正解です！"+"<br>Jan MB/FEI Spread購入を実施しました。"
    +"この先、変動する可能性のある、Jan MBとJan FEIをそれぞれ固定価格に持ち替えることで、損益を確定できました。")
    document.querySelector("#navigatorImg").src = Smile;
    $(".Paperbtn").prop("disabled", true)
    if(VesselName == "Ronald N"){
        $("#JanMBCountP").html("Jan MB(先物)");
        JanMBPositionP = JanMBPositionP-42;
        $("#FinancialJanMBP").val(JanMBPositionP);
        JanFEIPositionP = JanFEIPositionP+42
        $("#JanFEICountP").html("Jan FEI(先物)");
        $("#FinancialJanFEIP").val(JanFEIPositionP);
        $("#JanMBCountTotal").val(JanMBPosition + JanMBPositionP);
        $("#JanMBTotal").html("Jan MB計");
        $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);
        $("#JanFEITotal").html("Jan FEI計");
        // PL計算
        console.log(JanFEIPosition + JanFEIPositionP);
    }else{  
    $("#JanMBCountP").html("Jan MB(先物)");
    JanMBPositionP = JanMBPositionP-46.2;
    $("#FinancialJanMBP").val(JanMBPositionP);
    $("#JanFEICountP").html("Jan FEI(先物)");
    JanFEIPositionP = JanFEIPositionP+46.2
    $("#FinancialJanFEIP").val(JanFEIPositionP);
    $("#JanMBTotal").html("Jan MB計");
    $("#JanMBCountTotal").val(JanMBPosition + JanMBPositionP);
    $("#JanFEITotal").html("Jan FEI計");
    $("#JanFEICountTotal").val(JanFEIPosition + JanFEIPositionP);  
    }
Hedging = "completed"
})
$("#JanMBFEIBid").on("click", function(){
    $("#line0").html("左側が買い唱え(Bid)で右側が売り唱え(Offer)です。"
    +"今やるべきは売りか、買いか、どちらでしょう？？")
    document.querySelector("#navigatorImg").src = Normal;
})
$("#FebMBFEIBid").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#FebMBFEIOffer").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#MarMBFEIBid").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#MarMBFEIOffer").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#JanMBBid").on("click", function(){
    $("#line0").html("このBidを取れば、FOB購入価格の固定はできますが、販売価格が固定できないですね..."
    +"<br>それではヘッジはできていません。"
    +"<br>購入価格と販売価格の差分＝利益を固定することが目的ですから、もう一度考え直してみましょう！")
    document.querySelector("#navigatorImg").src = Smile;
})
$("#JanMBOffer").on("click", function(){
    $("#line0").html("左側が買い唱え(Bid)で右側が売り唱え(Offer)です。"
    +"<br>今やるべきは売りか、買いか、どちらでしょう？？")
    document.querySelector("#navigatorImg").src = Smile;
})
$("#JanCPBid").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#JanCPOffer").on("click", function(){
    $("#line0").html("現物の購入条件と販売条件を条件をもう一度確認してみましょう。")
    document.querySelector("#navigatorImg").src = Sad;
})
$("#JunMBFEIBid").on("click", function(){
    $("#line0").html("Jun(6月)です！"
    +"<br>これはちょっと不注意じゃないですか〜？")
    document.querySelector("#navigatorImg").src = Angry;
})
$("#JunMBFEIOffer").on("click", function(){
    $("#line0").html("Jun(6月)です！"
    +"<br>これはちょっと不注意じゃないですか〜？")
    document.querySelector("#navigatorImg").src = Angry;
})

// Map画面を表示
$("#map").on("click", function(){
    $("#TermContractScreen").toggle(false);
    $("#CharteringScreen").toggle(false);
    $("#WindowScreen").toggle(false);
    $("#HedgingScreen").toggle(false);
    $("#myMap").toggle(true);
    $("#line0").html("地図上で用船したVLGCの現在位置を位置を確認できます。")
})

//完了のクリックイベント
    const modal = $("#jsmodal");
    const overlay = $("#js-overlay");
    const close = $("#js-close")
$("#finish").on("click", function(){
    if(FOBDecision == "completed"){
    if(Chartering == "completed"){
    if(WindowSales == "completed"){
    if(Hedging == "completed"){
        $("#myMap").toggle(false);
        modal.addClass("open");
        overlay.addClass("open");
        let num = Math.trunc(Number(document.querySelector("#TotalPLAmount").value)) 
        // let num = PL.replace(/^[0]+/,'');
        let result = "";
        if(num){
			num = String(num).replace(/(\d)(?=(\d\d\d)+$)/g, "$1,");
			result = num;
        $("#Result").prepend("$"+result);
        }
    }}}} 
})

close.on("click", function(){
    modal.removeClass("open");
    overlay.removeClass("open");
})



  </script>
<!-- END of FIREBASE - Auth, FireSore, RTDB -->  
</body>

</html>